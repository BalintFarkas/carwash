"use strict";function getErrorMessage(n){var u=n.statusText,i,t,r;if(n.data!=null&&n.data.ModelState!=null){i=n.data.ModelState;t="";for(r in i)i.hasOwnProperty(r)&&(t=(t==""?"":t+"<br/>")+i[r]);u=t}return u}angular.module("carwashApp",["ngRoute","AdalAngular","ngMessages"]).config(["$routeProvider","$httpProvider","adalAuthenticationServiceProvider",function(n,t,i){n.when("/Home",{controller:"homeCtrl",templateUrl:"/app/views/home.html"}).when("/Calendar",{controller:"calendarCtrl",templateUrl:"/app/views/calendar.html",requireADLogin:!0}).when("/Reservation",{controller:"reservationCtrl",templateUrl:"/app/views/reservation.html",requireADLogin:!0}).when("/Day",{controller:"dayCtrl",templateUrl:"/app/views/day.html",requireADLogin:!0}).when("/UserData",{controller:"userDataCtrl",templateUrl:"/app/views/userData.html",requireADLogin:!0}).otherwise({redirectTo:"/Home"});i.init({tenant:"microsoft.onmicrosoft.com",clientId:"74a5dcad-a163-4b28-a9d2-c067ac3fedd5"},t)}]);angular.module("carwashApp").directive("loading",["$http","$timeout",function(n,t){return{restrict:"A",link:function(i,r){function f(){u||(u=t(function(){r.show()},300))}function e(){u&&t.cancel(u);u=null;r.hide()}var u;i.isLoading=function(){return n.pendingRequests.length>0};i.$watch(i.isLoading,function(n){n?f():e()})}}}]);angular.module("carwashApp").controller("calendarCtrl",["$scope","$location","calendarSvc","adalAuthenticationService",function(n,t,i){n.error="";n.currentUser=null;n.weekViewModel=null;n.dataLoaded=!1;n.init=function(){n.getCurrentUser();n.getweek(i.getValue("offset"))};n.getCurrentUser=function(){var t=i.getValue("currentUser");t==null&&i.getCurrentUser().then(function(t){n.currentUser=t.data;i.setValue("currentUser",t.data)},function(t){n.error=getErrorMessage(t)})};n.getweek=function(t){i.getWeek(t).then(function(t){n.weekViewModel=t.data;n.dataLoaded=!0},function(t){n.error=getErrorMessage(t);n.dataLoaded=!0})};n.showDay=function(n,r){i.setValue("day",n);i.setValue("offset",r);t.url("/Day")};n.checkParamValues=function(){var n=i.getValue("offset");(n==null||n=="undefined")&&t.url("/Home")};n.checkParamValues()}]);angular.module("carwashApp").controller("dayCtrl",["$scope","$location","calendarSvc","adalAuthenticationService",function(n,t,i){n.error="";n.dayDetailsViewModel=null;n.dataLoaded=!1;n.vehiclePlateNumberFormat=/[a-zA-Z]{3}-[0-9]{3}$/;n.kulsoBelsoKarpitDisabled=function(){return n.dayDetailsViewModel!=null&&n.dayDetailsViewModel.AvailableNormalSlots!=null&&n.dayDetailsViewModel.AvailableNormalSlots<2};n.steamDisabled=function(){return n.dayDetailsViewModel!=null&&n.dayDetailsViewModel.AvailableSteamSlots!=null&&n.dayDetailsViewModel.AvailableSteamSlots==0};n.init=function(){n.getDay(i.getValue("day"),i.getValue("offset"))};n.getDay=function(t,r){i.getDay(t,r).then(function(t){n.dayDetailsViewModel=t.data;n.dataLoaded=!0},function(t){n.error=getErrorMessage(t);n.dataLoaded=!0})};n.showCalendar=function(n){i.setValue("offset",n);t.url("/Calendar")};n.saveReservation=function(){i.saveReservation(n.dayDetailsViewModel.NewReservation).then(function(){n.getDay(i.getValue("day"),i.getValue("offset"))},function(t){n.error=getErrorMessage(t)})};n.showReservation=function(){return n.dayDetailsViewModel!=null&&n.dayDetailsViewModel.ReservationIsAllowed};n.deleteReservation=function(t){i.deleteReservation(t).then(function(){n.getDay(i.getValue("day"),i.getValue("offset"))},function(t){n.error=getErrorMessage(t)})};n.autoCompleteEmployeeName=function(){$("#inputName").autocomplete({source:function(t,r){n.dayDetailsViewModel.NewReservation.EmployeeId="";n.dayDetailsViewModel.NewReservation.VehiclePlateNumber="";var u=t.term;i.getEmployees(u).then(function(n){r($.map(n.data,function(n){return{value:n.Name,id:n.Id,vehiclePlateNumber:n.VehiclePlateNumber}}))},function(t){n.error=getErrorMessage(t)})},minLength:2,select:function(t,i){return n.dayDetailsViewModel.NewReservation.EmployeeId=i.item.id,n.dayDetailsViewModel.NewReservation.VehiclePlateNumber=i.item.vehiclePlateNumber,!1}})};n.checkParamValues=function(){var r=i.getValue("offset"),n;(r==null||r=="undefined")&&t.url("/Home");n=i.getValue("day");(n==null||n=="undefined")&&t.url("/Home")};n.checkParamValues()}]);angular.module("carwashApp").controller("homeCtrl",["$scope","adalAuthenticationService","$location","calendarSvc",function(n,t,i,r){n.login=function(){t.login()};n.logout=function(){t.logOut()};n.isActive=function(n){return n===i.path()};n.init=function(){r.setValue("offset",0)};n.showCalendar=function(){r.setValue("offset",0);i.url("/Calendar")}}]);angular.module("carwashApp").controller("reservationCtrl",["$scope","$location","calendarSvc","adalAuthenticationService",function(n,t,i){n.error="";n.reservationViewModel=null;n.dataLoaded=!1;n.init=function(){n.getReservations()};n.getReservations=function(){i.getReservations().then(function(t){n.reservationViewModel=t.data;n.dataLoaded=!0},function(t){n.error=getErrorMessage(t);n.dataLoaded=!0})};n.deleteReservation=function(t){i.deleteReservation(t).then(function(){n.getReservations()},function(t){n.error=getErrorMessage(t)})}}]);angular.module("carwashApp").controller("userDataCtrl",["$scope","adalAuthenticationService",function(){}]);angular.module("carwashApp").factory("calendarSvc",["$http",function(n){var t={};return{getCurrentUser:function(){return n({method:"GET",url:"/api/Employees/GetCurrentUser"})},getEmployees:function(t){return n({method:"GET",url:"/api/Employees/GetEmployees?searchTerm="+t})},getWeek:function(t){return n({method:"GET",url:"/api/Calendar/GetWeek?offSet="+t})},getDay:function(t,i){return n({method:"GET",url:"/api/Calendar/GetDay?day="+t+"&offset="+i})},saveReservation:function(t){return n({method:"POST",url:"/api/Calendar/SaveReservation",data:t})},deleteReservation:function(t){return n({method:"GET",url:"/api/Calendar/DeleteReservation?reservationId="+t})},getReservations:function(){return n({method:"GET",url:"/api/Calendar/GetReservations"})},setValue:function(n,i){t[n]=i},getValue:function(n){return t[n]}}}]);